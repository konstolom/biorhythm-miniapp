<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ë–∏–æ—Ä–∏—Ç–º—ã ¬∑ Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root { --pad:16px; }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:0;background:#f6f7fb;color:#111}
    .container{max-width:720px;margin:0 auto;padding:var(--pad)}
    .card{background:#fff;border-radius:16px;padding:var(--pad);box-shadow:0 2px 12px rgba(0,0,0,.06);margin-bottom:var(--pad);border:1px solid #eee}
    h1,h2,h3{margin:0 0 10px}
    label{display:block;margin:10px 0 6px}
    input,button,select{width:100%}
    /* –¥–∞—Ç–∞ */
    .date-row{display:flex;gap:8px}
    .date-row select{flex:1;padding:12px;border-radius:10px;border:1px solid #ddd;font-size:16px}
    input{padding:12px;border-radius:10px;border:1px solid #ddd;font-size:16px}
    /* –∫–Ω–æ–ø–∫–∏ */
    button{padding:14px 18px;border:0;border-radius:14px;font-weight:700;font-size:16px;line-height:1.2;cursor:pointer;background:#2ea6ff;color:#fff;display:inline-flex;align-items:center;justify-content:center;gap:10px}
    button .ico{font-size:20px;line-height:1}
    button.back{background:#fff;color:#111;border:1px solid #eee;padding:10px 14px;border-radius:12px;font-weight:600}
    button[disabled]{opacity:.6;cursor:not-allowed}
    /* –º–µ–Ω—é –Ω–∞ –≥–ª–∞–≤–Ω–æ–π */
    .menu{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width:560px){ .menu{grid-template-columns:1fr 1fr}}
    .menu button{background:#fff;color:#111;border:1px solid #eee}
    .menu button:hover{box-shadow:0 4px 16px rgba(0,0,0,.08)}
    /* —Å–µ—Ç–∫–∞ –º–µ—Å—è—Ü–µ–≤ */
    .months{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media (min-width:560px){ .months{grid-template-columns:repeat(4,1fr)}}
    /* —Å—Ç–∏–ª—å –∫–Ω–æ–ø–æ–∫ –º–µ—Å—è—Ü–∞ */
    .mBtn{background:#2ea6ff;color:#fff;border:2px solid #2ea6ff}
    .mBtn.active{background:#fff;color:#111;border:2px solid #2ea6ff}
    .hidden{display:none}
    .ok{color:#1a7f37;font-weight:600}
    .err{color:#b91c1c;font-weight:600}
    .muted{opacity:.8}
    /* —Ö–µ–¥–µ—Ä */
    header{display:flex;align-items:center;justify-content:space-between;padding:8px 0;gap:12px;flex-wrap:wrap}
    header .left{display:flex;align-items:center;gap:8px}
    header .right{margin-left:auto;display:flex;align-items:center;gap:8px;flex:1;justify-content:flex-end;min-width:0}
    .nameSpan{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60vw}
    /* –æ–ø–∏—Å–∞–Ω–∏—è */
    .desc p{margin:0 0 12px 0;text-indent:1.5em}
    .tag{display:inline-block;padding:2px 8px;border:1px solid #ddd;border-radius:999px;font-size:12px}
    /* —Ñ—É—Ç–µ—Ä */
    .support{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .support .msg{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;max-width:70%}
    .support .btn{background:#2ea6ff;color:#fff}
    /* —Ä–µ–∑—É–ª—å—Ç–∞—Ç */
    .result-row{display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:nowrap}
    .result-title{font-weight:800;font-size:20px}
    .result-pill{display:inline-block;font-weight:800;padding:10px 18px;border:3px solid #2ea6ff;border-radius:14px;color:#2ea6ff;font-size:28px;line-height:1}
    @media (min-width:560px){ .result-title{font-size:22px} .result-pill{font-size:32px} }

    /* –ü—Ä–æ—Ñ–∏–ª—å: —á–µ–∫–±–æ–∫—Å—ã */
    .checks{display:grid;grid-template-columns:1fr;gap:8px}
    @media (min-width:560px){ .checks{grid-template-columns:1fr 1fr} }
    .checks label{display:flex;align-items:center;gap:8px;border:1px solid #eee;border-radius:12px;padding:10px 12px;background:#fff}
    .checks input{width:auto}
  </style>
</head>
<body>
<div class="container">

  <!-- AUTH -->
  <section id="auth" class="card">
    <h2>–í—Ö–æ–¥</h2>
    <p class="muted">–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∞—à–∏–º –±–∏–æ—Ä–∏—Ç–º–∞–º –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É –∏ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è</p>

    <label>–í–∞—à email</label>
    <input id="email" type="email" placeholder="you@example.com" autocomplete="email" inputmode="email" />

    <label>–í–∞—à–∞ –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
    <div class="date-row" aria-label="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è">
      <select id="dobDay" aria-label="–î–µ–Ω—å"></select>
      <select id="dobMonth" aria-label="–ú–µ—Å—è—Ü"></select>
      <select id="dobYear" aria-label="–ì–æ–¥"></select>
    </div>

    <div style="height:16px"></div>
    <button id="login"><span class="ico">üîì</span>–í–æ–π—Ç–∏</button>
    <p id="auth_status" aria-live="polite"></p>
  </section>

  <!-- HOME -->
  <section id="home" class="hidden">
    <header>
      <div class="left">
        <button class="back" id="profileBtn" title="–ü—Ä–æ—Ñ–∏–ª—å"><span class="ico">üë§</span>–ø—Ä–æ—Ñ–∏–ª—å</button>
      </div>
      <div class="right">
        <span class="nameSpan" id="userName">‚Äî</span>
        <span class="tag" id="userDob">‚Äî</span>
      </div>
    </header>

    <div class="card">
      <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã –∏–∑—É—á–∏—Ç—å</h2>
      <div class="menu" style="margin-top:12px">
        <button id="btnYear"><span class="ico">üóìÔ∏è</span>–ë–∏–æ—Ä–∏—Ç–º—ã 2025 –≥–æ–¥–∞</button>
        <button id="btnMonths"><span class="ico">üìÜ</span>–ë–∏–æ—Ä–∏—Ç–º—ã –ø–æ –º–µ—Å—è—Ü–∞–º</button>
        <button id="btnHerbs"><span class="ico">üåø</span>–§–∏—Ç–æ—Ç–µ—Ä–∞–ø–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º</button>
        <button id="btnMinerals"><span class="ico">ü™®</span>–ú–∏–Ω–µ—Ä–∞–ª—ã –ø–æ –º–µ—Å—è—Ü–∞–º</button>
        <button id="btnVitamins"><span class="ico">üíä</span>–í–∏—Ç–∞–º–∏–Ω—ã –ø–æ –º–µ—Å—è—Ü–∞–º</button>
        <button id="btnOils"><span class="ico">üß¥</span>–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</button>
        <button id="btnSupplements"><span class="ico">üß™</span>–ë–ê–î—ã –ø–æ –º–µ—Å—è—Ü–∞–º</button>
      </div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <!-- YEAR PAGE -->
  <section id="year" class="hidden">
    <header>
      <div class="left"><button class="back" id="backHome"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card" style="text-align:center">
      <div class="result-row">
        <div class="result-title">–í–∞—à –±–∏–æ—Ä–∏—Ç–º 2025 –≥–æ–¥–∞</div>
        <div id="yearNumber" class="result-pill">‚Äî</div>
      </div>
    </div>

    <div class="card">
      <div id="yearDesc" class="desc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <!-- MONTH SECTIONS -->
  <section id="sec-monthly" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–ë–∏–æ—Ä–∏—Ç–º—ã –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button>
        <button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button>
        <button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button>
        <button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button>
        <button class="mBtn" data-m="6">–ò—é–Ω—å</button>
        <button class="mBtn" data-m="7">–ò—é–ª—å</button>
        <button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button>
        <button class="mBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button>
        <button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button>
        <button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-monthly" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–í–∞—à –±–∏–æ—Ä–∏—Ç–º <span class="mName">–º–µ—Å—è—Ü–∞</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-monthly" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <section id="sec-herbs" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–§–∏—Ç–æ—Ç–µ—Ä–∞–ø–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button><button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button><button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button><button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button><button class="mBtn" data-m="6">–ò—é–Ω—å</button><button class="mBtn" data-m="7">–ò—é–ª—å</button><button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button><button class="mBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button><button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button><button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-herbs" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–§–∏—Ç–æ—Ç–µ—Ä–∞–ø–∏—è <span class="mName">–º–µ—Å—è—Ü</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-herbs" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <section id="sec-minerals" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–ú–∏–Ω–µ—Ä–∞–ª—ã –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button><button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button><button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button><button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button><button class="mBtn" data-m="6">–ò—é–Ω—å</button><button class="mBtn" data-m="7">–ò—é–ª—å</button><button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button><button class="mBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button><button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button><button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-minerals" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–ú–∏–Ω–µ—Ä–∞–ª—ã <span class="mName">–º–µ—Å—è—Ü</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-minerals" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <section id="sec-vitamins" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–í–∏—Ç–∞–º–∏–Ω—ã –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button><button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button><button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button><button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button><button class="mBtn" data-m="6">–ò—é–Ω—å</button><button class="mBtn" data-m="7">–ò—é–ª—å</button><button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button><button class="–ºBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button><button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button><button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-vitamins" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–í–∏—Ç–∞–º–∏–Ω—ã <span class="mName">–º–µ—Å—è—Ü</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-vitamins" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <section id="sec-oils" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button><button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button><button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button><button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button><button class="mBtn" data-m="6">–ò—é–Ω—å</button><button class="mBtn" data-m="7">–ò—é–ª—å</button><button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button><button class="mBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button><button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button><button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-oils" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ <span class="mName">–º–µ—Å—è—Ü</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-oils" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <section id="sec-supplements" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–ë–ê–î—ã –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button><button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button><button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button><button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button><button class="mBtn" data-m="6">–ò—é–Ω—å</button><button class="mBtn" data-m="7">–ò—é–ª—å</button><button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button><button class="mBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button><button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button><button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-supplements" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–ë–ê–î—ã <span class="mName">–º–µ—Å—è—Ü</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-supplements" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <!-- PROFILE (–∞–Ω–∫–µ—Ç–∞) -->
  <section id="profile" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span></div>
    </header>

    <div class="card">
      <h2><span id="welcomeName">‚Äî</span>, –¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
      <p class="muted">–ß—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–∞—à–∏–º –±–∏–æ—Ä–∏—Ç–º–∞–º ‚Äî –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–±–æ–ª—å—à—É—é –∞–Ω–∫–µ—Ç—É.</p>
    </div>

    <div class="card">
      <label>–ì–¥–µ –≤—ã —Ä–æ–¥–∏–ª–∏—Å—å?</label>
      <input id="q_birthplace" type="text" placeholder="–ì–æ—Ä–æ–¥, —Å—Ç—Ä–∞–Ω–∞" />

      <label style="margin-top:16px">–û—Ç–º–µ—Ç—å—Ç–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–µ –≤–∞–º–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è</label>
      <div id="q_self" class="checks"></div>

      <label style="margin-top:16px">–û—Ç–º–µ—Ç—å—Ç–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è, –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–µ –≤–∞—à–∏–º–∏ —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏</label>
      <div id="q_parents" class="checks"></div>

      <label style="margin-top:16px">–ó–∞–º–µ—á–∞–µ—Ç–µ –ª–∏ –≤—ã —É—Ö—É–¥—à–µ–Ω–∏–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è –ø–æ —Å–µ–∑–æ–Ω–∞–º?</label>
      <div id="q_seasons" class="checks"></div>

      <label style="margin-top:16px">–û—Ç–º–µ—Ç—å—Ç–µ –∏–Ω—Ñ–µ–∫—Ü–∏–∏, –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–µ –≤–∞–º–∏ –≤ –¥–µ—Ç—Å—Ç–≤–µ</label>
      <div id="q_infections" class="checks"></div>

      <div style="height:16px"></div>
      <button id="profileSave"><span class="ico">üíæ</span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <p id="profile_status" aria-live="polite"></p>
    </div>
  </section>

  <!-- PROFILE VIEW (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä) -->
  <section id="profileView" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag" id="pvDob">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
      <div class="desc">
        <p><strong>–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> <span id="pv_birthplace">‚Äî</span></p>
        <p><strong>–í–∞—à–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è:</strong> <span id="pv_self">‚Äî</span></p>
        <p><strong>–ó–∞–±–æ–ª–µ–≤–∞–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π:</strong> <span id="pv_parents">‚Äî</span></p>
        <p><strong>–°–µ–∑–æ–Ω—ã —É—Ö—É–¥—à–µ–Ω–∏—è —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è:</strong> <span id="pv_seasons">‚Äî</span></p>
        <p><strong>–î–µ—Ç—Å–∫–∏–µ –∏–Ω—Ñ–µ–∫—Ü–∏–∏:</strong> <span id="pv_infections">‚Äî</span></p>
      </div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

</div>

<!-- –¥–∞–Ω–Ω—ã–µ -->
<script src="/data.js"></script>

<script>
const tg = window.Telegram?.WebApp; tg?.expand?.();
const STATE = { user: null, data: null };

function el(id){ return document.getElementById(id); }
function show(id){
  const sections = ['auth','home','year','sec-monthly','sec-herbs','sec-minerals','sec-vitamins','sec-oils','sec-supplements','profile','profileView'];
  for (const s of sections) el(s)?.classList.add('hidden');
  el(id).classList.remove('hidden');
}
function fmtDob(iso){ if(!iso) return '‚Äî'; const [Y,M,D] = iso.slice(0,10).split('-'); return `${D}.${M}.${Y}`; }
function reduceTo22(n){ while(n > 22){ n = String(n).split('').reduce((a,b)=>a + Number(b), 0);} return n; }
function computeGeneral2025(dobIso){ const [Y,M,D] = dobIso.slice(0,10).split('-').map(Number); return reduceTo22(D + M + 9); }
function computeMonthly(dobIso, monthNum){ const [Y,M,D] = dobIso.slice(0,10).split('-').map(Number); return reduceTo22(D + M + 9 + Number(monthNum)); }

async function loadData(){ if (STATE.data) return STATE.data; if (!window.APP_DATA) throw new Error('APP_DATA not found'); STATE.data = window.APP_DATA; return STATE.data; }

async function verify(email, dobIso){
  const initData = window.Telegram?.WebApp?.initData || '';
  const r = await fetch(`/api/verify?email=${encodeURIComponent(email)}&dob=${encodeURIComponent(dobIso)}`, {
    headers: { 'x-telegram-init-data': initData }
  });
  return r.json();
}


/* —Å–µ–ª–µ–∫—Ç—ã –¥–∞—Ç—ã */
(function initDOB(){
  const dd = el('dobDay'), mm = el('dobMonth'), yy = el('dobYear');
  dd.innerHTML = '<option value="" disabled selected>–î–µ–Ω—å</option>' + Array.from({length:31}, (_,i)=>`<option value="${String(i+1).padStart(2,'0')}">${i+1}</option>`).join('');
  const months = ['–Ø–Ω–≤','–§–µ–≤','–ú–∞—Ä','–ê–ø—Ä','–ú–∞–π','–ò—é–Ω','–ò—é–ª','–ê–≤–≥','–°–µ–Ω','–û–∫—Ç','–ù–æ—è','–î–µ–∫'];
  mm.innerHTML = '<option value="" disabled selected>–ú–µ—Å</option>' + months.map((m,i)=>`<option value="${String(i+1).padStart(2,'0')}">${String(i+1).padStart(2,'0')} ‚Äî ${m}</option>`).join('');
  const thisYear = new Date().getFullYear(); const startYear = 1930;
  yy.innerHTML = '<option value="" disabled selected>–ì–æ–¥</option>' + Array.from({length:thisYear-startYear+1}, (_,k)=>thisYear-k).map(y=>`<option value="${y}">${y}</option>`).join('');
})();

function getDOBISO(){
  const dd = el('dobDay').value, mm = el('dobMonth').value, yy = el('dobYear').value;
  if (!dd || !mm || !yy) return '';
  const d = new Date(Number(yy), Number(mm)-1, Number(dd));
  if (d.getFullYear() != yy || (d.getMonth()+1) != Number(mm) || d.getDate() != Number(dd)) return '';
  return `${yy}-${mm}-${dd}`;
}

/* –¥–µ–ª–∏–º —Ç–µ–∫—Å—Ç –Ω–∞ –∞–±–∑–∞—Ü—ã */
function splitIntoParagraphs(text){
  const partsByBreak = text.split(/\n{2,}/).map(s=>s.trim()).filter(Boolean);
  if (partsByBreak.length >= 2 && partsByBreak.length <= 4) return partsByBreak;
  const sentences = text.split(/(?<=\.)\s+/).map(s=>s.trim()).filter(Boolean);
  if (sentences.length <= 3) { return [sentences.join(' ')]; }
  else if (sentences.length <= 6) { const mid = Math.ceil(sentences.length/2); return [sentences.slice(0,mid).join(' '), sentences.slice(mid).join(' ')]; }
  else { const third = Math.ceil(sentences.length/3); return [ sentences.slice(0, third).join(' '), sentences.slice(third, third*2).join(' '), sentences.slice(third*2).join(' ') ]; }
}

/* –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è: –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ö–µ–¥–µ—Ä –≤ —Å–µ–∫—Ü–∏–∏ */
function fillHeader(sectionId){
  const sec = el(sectionId);
  if(!sec) return;
  const nameSpan = sec.querySelector('.nameSpan');
  const tagSpan  = sec.querySelector('.tag');
  if (nameSpan) nameSpan.textContent = STATE.user?.name || '‚Äî';
  if (tagSpan)  tagSpan.textContent  = fmtDob(STATE.user?.dob);
}

/* ===== –ü—Ä–æ—Ñ–∏–ª—å: –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ helpers ===== */
const DISEASES = [
  '–±–æ–ª–µ–∑–Ω–∏ –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—è',
  '–±–æ–ª–µ–∑–Ω–∏ –ø–æ–ª–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤',
  '–±–æ–ª–µ–∑–Ω–∏ –ø–æ—á–µ–∫ –∏ –º–æ—á–µ–≤–æ–≥–æ –ø—É–∑—ã—Ä—è',
  '–±–æ–ª–µ–∑–Ω–∏ –∫–æ–∂–∏',
  '–±–æ–ª–µ–∑–Ω–∏ –ª—ë–≥–∫–∏—Ö –∏ –≥–æ—Ä–ª–∞',
  '–±–æ–ª–µ–∑–Ω–∏ –≥–ª–∞–∑',
  '–∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã',
  '–±–æ–ª–µ–∑–Ω–∏ –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞ –∏ —Å—É—Å—Ç–∞–≤–æ–≤'
];
const SEASONS = ['–∑–∏–º–∞','–≤–µ—Å–Ω–∞','–ª–µ—Ç–æ','–æ—Å–µ–Ω—å'];
const INFECTIONS = ['–∫–æ—Ä—å','–∫—Ä–∞—Å–Ω—É—Ö–∞','–≤–µ—Ç—Ä—è–Ω–∫–∞','—Å–≤–∏–Ω–∫–∞','—Å–∫–∞—Ä–ª–∞—Ç–∏–Ω–∞'];

function renderChecks(container, arr, name){
  container.innerHTML = arr.map(v => `
    <label><input type="checkbox" name="${name}" value="${v}"> ${v}</label>
  `).join('');
}
function getChecked(name){
  return Array.from(document.querySelectorAll(`#profile input[name="${name}"]:checked`)).map(i => i.value);
}
function openProfileForm(){
  fillHeader('profile');
  el('welcomeName').textContent = STATE.user?.name || '–ì–æ—Å—Ç—å';
  renderChecks(el('q_self'), DISEASES, 'self');
  renderChecks(el('q_parents'), DISEASES, 'parents');
  renderChecks(el('q_seasons'), SEASONS, 'seasons');
  renderChecks(el('q_infections'), INFECTIONS, 'infections');
  el('profile_status').textContent = '';
  el('q_birthplace').value = '';
  show('profile');
}
function openProfileView(profile){
  fillHeader('profileView');
  el('pvDob').textContent = fmtDob(STATE.user?.dob);
  el('pv_birthplace').textContent = profile.birthplace || '‚Äî';
  el('pv_self').textContent = (profile.diseases_self||[]).join(', ') || '‚Äî';
  el('pv_parents').textContent = (profile.diseases_parents||[]).join(', ') || '‚Äî';
  el('pv_seasons').textContent = (profile.seasons||[]).join(', ') || '‚Äî';
  el('pv_infections').textContent = (profile.infections||[]).join(', ') || '‚Äî';
  show('profileView');
}
async function apiGetProfile(){
  const initData = window.Telegram?.WebApp?.initData || '';
  const r = await fetch(`/api/profile?email=${encodeURIComponent(STATE.user.email)}`, {
    headers: { 'x-telegram-init-data': initData }
  });
  return r.json();
}
async function apiCreateOrUpdateProfile(payload){
  const initData = window.Telegram?.WebApp?.initData || '';
  const r = await fetch(`/api/profile`, {
    method:'PUT',
    headers: { 'content-type':'application/json','x-telegram-init-data': initData },
    body: JSON.stringify({ email: STATE.user.email, ...payload })
  });
  return r.json();
}

/* ===== –õ–æ–≥–∏–Ω ===== */
el('login').onclick = async () => {
  const email = el('email').value.trim().toLowerCase();
  const dobIso = getDOBISO();
  const st = el('auth_status');
  if(!email || !dobIso){ st.textContent='–í–≤–µ–¥–∏—Ç–µ e-mail –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è'; st.className='err'; return; }
  st.textContent='–ü—Ä–æ–≤–µ—Ä—è–µ–º...'; st.className='';

  try{
    const data = await verify(email, dobIso);
    if(!data.ok){ st.textContent = data.error || '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞'; st.className='err'; return; }
    STATE.user = { email: data.user?.email || email, name: data.user?.name || '–ë–µ–∑ –∏–º–µ–Ω–∏', dob: (data.user?.dob || dobIso).slice(0,10) };
    document.querySelectorAll('#home .nameSpan').forEach(n=>n.textContent=STATE.user.name);
    el('userName').textContent = STATE.user.name;
    el('userDob').textContent = fmtDob(STATE.user.dob);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è: –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç => –∞–Ω–∫–µ—Ç–∞, –∏–Ω–∞—á–µ –≥–ª–∞–≤–Ω–∞—è
    try{
      const r = await apiGetProfile();
      const isEmpty = !r?.profile || Object.keys(r.profile).length === 0;
      if(r.ok && !isEmpty){ show('home'); }
      else { openProfileForm(); }
    }catch(e){ openProfileForm(); }
  }catch(e){ st.textContent='–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è'; st.className='err'; }
};

/* YEAR */
el('btnYear').onclick = async () => {
  try {
    fillHeader('year');
    const num = computeGeneral2025(STATE.user.dob);
    el('yearNumber').textContent = num;
    const DATA = await loadData();
    let desc = DATA?.GENERAL?.[String(num)] || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.';
    const paragraphs = splitIntoParagraphs(desc);
    el('yearDesc').innerHTML = paragraphs.map(p => `<p>${p}</p>`).join('');
    show('year');
  } catch (err) { console.error('btnYear error:', err); alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ä–∞–∑–¥–µ–ª–∞.'); }
};
el('backHome').onclick = () => show('home');

/* MONTH SECTIONS ‚Äî –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ */
const MONTH_NAMES_FULL = ['–Ø–Ω–≤–∞—Ä—è','–§–µ–≤—Ä–∞–ª—è','–ú–∞—Ä—Ç–∞','–ê–ø—Ä–µ–ª—è','–ú–∞—è','–ò—é–Ω—è','–ò—é–ª—è','–ê–≤–≥—É—Å—Ç–∞','–°–µ–Ω—Ç—è–±—Ä—è','–û–∫—Ç—è–±—Ä—è','–ù–æ—è–±—Ä—è','–î–µ–∫–∞–±—Ä—è'];

function setupMonthSection(secId, dataKey){
  const sec = el(secId);
  const btns = sec.querySelectorAll('.mBtn');
  const resCard  = sec.querySelector('#res-' + secId.split('sec-')[1]);
  const descCard = sec.querySelector('#desc-' + secId.split('sec-')[1]);
  const nameEl = sec.querySelector('.mName');
  const numEl  = sec.querySelector('.mNum');
  const descEl = sec.querySelector('.mDesc');

  btns.forEach(b=>{
    b.addEventListener('click', async () => {
      btns.forEach(x=>x.classList.remove('active'));
      b.classList.add('active');

      const m = Number(b.dataset.m);
      const num = computeMonthly(STATE.user.dob, m);
      if(nameEl) nameEl.textContent = MONTH_NAMES_FULL[m-1];
      if(numEl)  numEl.textContent  = num;

      const DATA = await loadData();
      let desc = DATA?.[dataKey]?.[String(num)] || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.';
      const paragraphs = splitIntoParagraphs(desc);
      if(descEl) descEl.innerHTML = paragraphs.map(p => `<p>${p}</p>`).join('');

      if(resCard) resCard.style.display = '';
      if(descCard) descCard.style.display = '';

      setTimeout(()=>{ resCard?.scrollIntoView({ behavior:'smooth', block:'start' }); }, 40);
    });
  });

  fillHeader(secId);
}

/* –ø–µ—Ä–µ—Ö–æ–¥—ã –≤ —Ä–∞–∑–¥–µ–ª—ã */
el('btnMonths').onclick     = () => { fillHeader('sec-monthly'); show('sec-monthly'); };
el('btnHerbs').onclick      = () => { fillHeader('sec-herbs'); show('sec-herbs'); };
el('btnMinerals').onclick   = () => { fillHeader('sec-minerals'); show('sec-minerals'); };
el('btnVitamins').onclick   = () => { fillHeader('sec-vitamins'); show('sec-vitamins'); };
el('btnOils').onclick       = () => { fillHeader('sec-oils'); show('sec-oils'); };
el('btnSupplements').onclick= () => { fillHeader('sec-supplements'); show('sec-supplements'); };

/* –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ —Å–µ–∫—Ü–∏—è—Ö */
document.querySelectorAll('button.back[data-back="home"]').forEach(b=>{
  b.addEventListener('click', ()=> show('home'));
});

/* –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π –ø–æ –º–µ—Å—è—Ü–∞–º */
setupMonthSection('sec-monthly',    'MONTHLY');
setupMonthSection('sec-herbs',      'HERBS');
setupMonthSection('sec-minerals',   'MINERALS');
setupMonthSection('sec-vitamins',   'VITAMINS');
setupMonthSection('sec-oils',       'OILS');
setupMonthSection('sec-supplements','SUPPLEMENTS');

/* –ü—Ä–æ—Ñ–∏–ª—å: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å (PUT) */
el('profileSave').onclick = async () => {
  const s = el('profile_status');
  const btn = el('profileSave');
  const birthplace = el('q_birthplace').value.trim();
  const diseases_self = getChecked('self');
  const diseases_parents = getChecked('parents');
  const seasons = getChecked('seasons');
  const infections = getChecked('infections');

  if(!birthplace){ s.textContent='–£–∫–∞–∂–∏—Ç–µ –º–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è'; s.className='err'; return; }

  s.textContent='–°–æ—Ö—Ä–∞–Ω—è–µ–º...'; s.className='muted'; btn.disabled = true;
  try{
    const data = await apiCreateOrUpdateProfile({ birthplace, diseases_self, diseases_parents, seasons, infections });
    if(!data.ok){ s.textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'; s.className='err'; btn.disabled = false; return; }
    s.textContent='–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ'; s.className='ok';
    show('home');
  }catch(e){ s.textContent='–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'; s.className='err'; }
  finally{ btn.disabled = false; }
};

/* –ö–Ω–æ–ø–∫–∞ ¬´–ü—Ä–æ—Ñ–∏–ª—å¬ª –Ω–∞ –≥–ª–∞–≤–Ω–æ–π */
el('profileBtn').onclick = async () => {
  try{
    const r = await apiGetProfile();
    const isEmpty = !r?.profile || Object.keys(r.profile).length === 0;
    if (!isEmpty) { openProfileView(r.profile); }
    else { openProfileForm(); }
  }catch(e){ openProfileForm(); }
};
</script>
</body>
</html>





