<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ë–∏–æ—Ä–∏—Ç–º—ã ¬∑ Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root { --pad:16px; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:0;background:#f6f7fb;color:#111}
    .container{max-width:720px;margin:0 auto;padding:var(--pad)}
    .card{background:#fff;border-radius:16px;padding:var(--pad);box-shadow:0 2px 12px rgba(0,0,0,.06);margin-bottom:var(--pad)}
    h1,h2,h3{margin:0 0 10px}
    label{display:block;margin:10px 0 6px}
    input,button,select{width:100%}
    /* –¥–∞—Ç–∞ */
    .date-row{display:flex;gap:8px}
    .date-row select{flex:1;padding:12px;border-radius:10px;border:1px solid #ddd;font-size:16px}
    input{padding:12px;border-radius:10px;border:1px solid #ddd;font-size:16px}
    /* –∫–Ω–æ–ø–∫–∏ */
    button{padding:14px 18px;border:0;border-radius:14px;font-weight:700;font-size:16px;line-height:1.2;cursor:pointer;background:#2ea6ff;color:#fff;display:inline-flex;align-items:center;justify-content:center;gap:10px}
    button .ico{font-size:20px;line-height:1}
    /* –º–µ–Ω—é –Ω–∞ –≥–ª–∞–≤–Ω–æ–π */
    .menu{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width:560px){ .menu{grid-template-columns:1fr 1fr}}
    .menu button{background:#fff;color:#111;border:1px solid #eee}
    .menu button:hover{box-shadow:0 4px 16px rgba(0,0,0,.08)}
    /* —Å–µ—Ç–∫–∞ –º–µ—Å—è—Ü–µ–≤ */
    .months{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media (min-width:560px){ .months{grid-template-columns:repeat(4,1fr)}}
    /* —Å—Ç–∏–ª—å –∫–Ω–æ–ø–æ–∫ –º–µ—Å—è—Ü–∞: –¥–µ—Ñ–æ–ª—Ç ‚Äî —Å–∏–Ω–∏–µ; –∞–∫—Ç–∏–≤–Ω–∞—è ‚Äî –±–µ–ª–∞—è —Å —Å–∏–Ω–µ–π –æ–±–≤–æ–¥–∫–æ–π */
    .mBtn{background:#2ea6ff;color:#fff;border:2px solid #2ea6ff}
    .mBtn.active{background:#fff;color:#111;border:2px solid #2ea6ff}
    .hidden{display:none}
    .ok{color:#1a7f37;font-weight:600}
    .err{color:#b91c1c;font-weight:600}
    .muted{opacity:.8}
    /* —Ö–µ–¥–µ—Ä */
    header{display:flex;align-items:center;justify-content:space-between;padding:8px 0;gap:12px;flex-wrap:wrap}
    header .left{display:flex;align-items:center;gap:8px}
    header .right{margin-left:auto;display:flex;align-items:center;gap:8px;flex:1;justify-content:flex-end;min-width:0}
    .nameSpan{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60vw}
    .back{background:#fff;color:#111;border:1px solid #eee;padding:10px 14px;border-radius:12px;font-weight:600}
    /* –æ–ø–∏—Å–∞–Ω–∏—è */
    .desc p{margin:0 0 12px 0;text-indent:1.5em}
    .tag{display:inline-block;padding:2px 8px;border:1px solid #ddd;border-radius:999px;font-size:12px}
    /* —Ñ—É—Ç–µ—Ä */
    .support{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .support .msg{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;max-width:70%}
    .support .btn{background:#2ea6ff;color:#fff}
    /* —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å—Ç—Ä–æ–∫—É */
    .result-row{display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:nowrap}
    .result-title{font-weight:800;font-size:20px}
    .result-pill{display:inline-block;font-weight:800;padding:10px 18px;border:3px solid #2ea6ff;border-radius:14px;color:#2ea6ff;font-size:28px;line-height:1}
    @media (min-width:560px){ .result-title{font-size:22px} .result-pill{font-size:32px} }
  </style>
</head>
<body>
<div class="container">

  <!-- AUTH -->
  <section id="auth" class="card">
    <h2>–í—Ö–æ–¥</h2>
    <p class="muted">–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∞—à–∏–º –±–∏–æ—Ä–∏—Ç–º–∞–º –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É –∏ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è</p>

    <label>–í–∞—à email</label>
    <input id="email" type="email" placeholder="you@example.com" autocomplete="email" inputmode="email" />

    <label>–í–∞—à–∞ –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
    <div class="date-row" aria-label="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è">
      <select id="dobDay" aria-label="–î–µ–Ω—å"></select>
      <select id="dobMonth" aria-label="–ú–µ—Å—è—Ü"></select>
      <select id="dobYear" aria-label="–ì–æ–¥"></select>
    </div>

    <div style="height:16px"></div>
    <button id="login"><span class="ico">üîì</span>–í–æ–π—Ç–∏</button>
    <p id="auth_status"></p>
  </section>

  <!-- HOME -->
  <section id="home" class="hidden">
    <header>
      <div class="left">
        <button class="back" id="profileBtn" title="–ü—Ä–æ—Ñ–∏–ª—å"><span class="ico">üë§</span>–ø—Ä–æ—Ñ–∏–ª—å</button>
      </div>
      <div class="right">
        <span class="nameSpan" id="userName">‚Äî</span>
        <span class="tag" id="userDob">‚Äî</span>
      </div>
    </header>

    <div class="card">
      <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã –∏–∑—É—á–∏—Ç—å</h2>
      <div class="menu" style="margin-top:12px">
        <button id="btnYear"><span class="ico">üóìÔ∏è</span>–ë–∏–æ—Ä–∏—Ç–º—ã 2025 –≥–æ–¥–∞</button>
        <button id="btnMonths"><span class="ico">üìÜ</span>–ë–∏–æ—Ä–∏—Ç–º—ã –ø–æ –º–µ—Å—è—Ü–∞–º</button>
        <button id="btnHerbs"><span class="ico">üåø</span>–§–∏—Ç–æ—Ç–µ—Ä–∞–ø–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º</button>
        <button id="btnMinerals"><span class="ico">ü™®</span>–ú–∏–Ω–µ—Ä–∞–ª—ã –ø–æ –º–µ—Å—è—Ü–∞–º</button>
        <button id="btnVitamins"><span class="ico">üíä</span>–í–∏—Ç–∞–º–∏–Ω—ã –ø–æ –º–µ—Å—è—Ü–∞–º</button>
        <button id="btnOils"><span class="ico">üß¥</span>–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</button>
        <button id="btnSupplements"><span class="ico">üß™</span>–ë–ê–î—ã –ø–æ –º–µ—Å—è—Ü–∞–º</button>
      </div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <!-- YEAR PAGE -->
  <section id="year" class="hidden">
    <header>
      <div class="left"><button class="back" id="backHome"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card" style="text-align:center">
      <div class="result-row">
        <div class="result-title">–í–∞—à –±–∏–æ—Ä–∏—Ç–º 2025 –≥–æ–¥–∞</div>
        <div id="yearNumber" class="result-pill">‚Äî</div>
      </div>
    </div>

    <div class="card">
      <div id="yearDesc" class="desc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <!-- MONTH TEMPLATES (6 —Ä–∞–∑–¥–µ–ª–æ–≤, –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞) -->
  <!-- 1) –ë–∏–æ—Ä–∏—Ç–º—ã –ø–æ –º–µ—Å—è—Ü–∞–º -->
  <section id="sec-monthly" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–ë–∏–æ—Ä–∏—Ç–º—ã –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <!-- 12 –∫–Ω–æ–ø–æ–∫ -->
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button>
        <button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button>
        <button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button>
        <button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button>
        <button class="mBtn" data-m="6">–ò—é–Ω—å</button>
        <button class="mBtn" data-m="7">–ò—é–ª—å</button>
        <button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button>
        <button class="mBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button>
        <button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button>
        <button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-monthly" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–í–∞—à –±–∏–æ—Ä–∏—Ç–º <span class="mName">–º–µ—Å—è—Ü–∞</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-monthly" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <!-- 2) –§–∏—Ç–æ—Ç–µ—Ä–∞–ø–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º -->
  <section id="sec-herbs" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–§–∏—Ç–æ—Ç–µ—Ä–∞–ø–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button><button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button><button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button><button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button><button class="mBtn" data-m="6">–ò—é–Ω—å</button><button class="mBtn" data-m="7">–ò—é–ª—å</button><button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button><button class="mBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button><button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button><button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-herbs" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–§–∏—Ç–æ—Ç–µ—Ä–∞–ø–∏—è ‚Äî <span class="mName">–º–µ—Å—è—Ü</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-herbs" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <!-- 3) –ú–∏–Ω–µ—Ä–∞–ª—ã –ø–æ –º–µ—Å—è—Ü–∞–º -->
  <section id="sec-minerals" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–ú–∏–Ω–µ—Ä–∞–ª—ã –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button><button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button><button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button><button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button><button class="mBtn" data-m="6">–ò—é–Ω—å</button><button class="mBtn" data-m="7">–ò—é–ª—å</button><button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button><button class="mBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button><button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button><button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-minerals" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–ú–∏–Ω–µ—Ä–∞–ª—ã ‚Äî <span class="mName">–º–µ—Å—è—Ü</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-minerals" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <!-- 4) –í–∏—Ç–∞–º–∏–Ω—ã –ø–æ –º–µ—Å—è—Ü–∞–º -->
  <section id="sec-vitamins" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–í–∏—Ç–∞–º–∏–Ω—ã –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button><button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button><button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button><button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button><button class="mBtn" data-m="6">–ò—é–Ω—å</button><button class="mBtn" data-m="7">–ò—é–ª—å</button><button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button><button class="mBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button><button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button><button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-vitamins" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–í–∏—Ç–∞–º–∏–Ω—ã ‚Äî <span class="mName">–º–µ—Å—è—Ü</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-vitamins" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <!-- 5) –≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –ø–æ –º–µ—Å—è—Ü–∞–º -->
  <section id="sec-oils" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button><button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button><button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button><button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button><button class="mBtn" data-m="6">–ò—é–Ω—å</button><button class="mBtn" data-m="7">–ò—é–ª—å</button><button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button><button class="mBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button><button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button><button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-oils" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ ‚Äî <span class="mName">–º–µ—Å—è—Ü</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-oils" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

  <!-- 6) –ë–ê–î—ã –ø–æ –º–µ—Å—è—Ü–∞–º -->
  <section id="sec-supplements" class="hidden">
    <header>
      <div class="left"><button class="back" data-back="home"><span class="ico">‚¨ÖÔ∏è</span>–ù–∞–∑–∞–¥</button></div>
      <div class="right"><span class="nameSpan">‚Äî</span><span class="tag">‚Äî</span></div>
    </header>

    <div class="card">
      <h2>–ë–ê–î—ã –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
      <div class="months" style="margin-top:12px">
        <button class="mBtn" data-m="1">–Ø–Ω–≤–∞—Ä—å</button><button class="mBtn" data-m="2">–§–µ–≤—Ä–∞–ª—å</button><button class="mBtn" data-m="3">–ú–∞—Ä—Ç</button><button class="mBtn" data-m="4">–ê–ø—Ä–µ–ª—å</button>
        <button class="mBtn" data-m="5">–ú–∞–π</button><button class="mBtn" data-m="6">–ò—é–Ω—å</button><button class="mBtn" data-m="7">–ò—é–ª—å</button><button class="mBtn" data-m="8">–ê–≤–≥—É—Å—Ç</button>
        <button class="mBtn" data-m="9">–°–µ–Ω—Ç—è–±—Ä—å</button><button class="mBtn" data-m="10">–û–∫—Ç—è–±—Ä—å</button><button class="mBtn" data-m="11">–ù–æ—è–±—Ä—å</button><button class="mBtn" data-m="12">–î–µ–∫–∞–±—Ä—å</button>
      </div>
    </div>

    <div class="card" id="res-supplements" style="text-align:center; display:none">
      <div class="result-row">
        <div class="result-title">–ë–ê–î—ã ‚Äî <span class="mName">–º–µ—Å—è—Ü</span></div>
        <div class="result-pill mNum">‚Äî</div>
      </div>
    </div>

    <div class="card" id="desc-supplements" style="display:none">
      <div class="desc mDesc"></div>
    </div>

    <footer class="support card">
      <div class="muted msg">–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?</div>
      <a href="https://t.me/konstolom" target="_blank" rel="noopener">
        <button class="btn"><span class="ico">üÜò</span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
      </a>
    </footer>
  </section>

</div>

<!-- –¥–∞–Ω–Ω—ã–µ -->
<script src="/data.js"></script>

<!-- –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
<script>
const tg = window.Telegram?.WebApp; tg?.expand?.();
const STATE = { user: null, data: null };

function el(id){ return document.getElementById(id); }
function show(id){ for (const s of ['auth','home','year','sec-monthly','sec-herbs','sec-minerals','sec-vitamins','sec-oils','sec-supplements']) el(s)?.classList.add('hidden'); el(id).classList.remove('hidden'); }
function fmtDob(iso){ if(!iso) return '‚Äî'; const [Y,M,D] = iso.slice(0,10).split('-'); return `${D}.${M}.${Y}`; }
function reduceTo22(n){ while(n > 22){ n = String(n).split('').reduce((a,b)=>a + Number(b), 0);} return n; }
function computeGeneral2025(dobIso){ const [Y,M,D] = dobIso.slice(0,10).split('-').map(Number); return reduceTo22(D + M + 9); }
function computeMonthly(dobIso, monthNum){ const [Y,M,D] = dobIso.slice(0,10).split('-').map(Number); return reduceTo22(D + M + 9 + Number(monthNum)); }

async function loadData(){ if (STATE.data) return STATE.data; if (!window.APP_DATA) throw new Error('APP_DATA not found'); STATE.data = window.APP_DATA; return STATE.data; }

async function verify(email, dobIso){
  const initData = window.Telegram?.WebApp?.initData || '';
  const r = await fetch(`/api/verify?email=${encodeURIComponent(email)}&dob=${encodeURIComponent(dobIso)}`, { headers: { 'x-telegram-init-data': initData } });
  return r.json();
}

/* —Å–µ–ª–µ–∫—Ç—ã –¥–∞—Ç—ã */
(function initDOB(){
  const dd = el('dobDay'), mm = el('dobMonth'), yy = el('dobYear');
  dd.innerHTML = '<option value="" disabled selected>–î–µ–Ω—å</option>' + Array.from({length:31}, (_,i)=>`<option value="${String(i+1).padStart(2,'0')}">${i+1}</option>`).join('');
  const months = ['–Ø–Ω–≤','–§–µ–≤','–ú–∞—Ä','–ê–ø—Ä','–ú–∞–π','–ò—é–Ω','–ò—é–ª','–ê–≤–≥','–°–µ–Ω','–û–∫—Ç','–ù–æ—è','–î–µ–∫'];
  mm.innerHTML = '<option value="" disabled selected>–ú–µ—Å</option>' + months.map((m,i)=>`<option value="${String(i+1).padStart(2,'0')}">${String(i+1).padStart(2,'0')} ‚Äî ${m}</option>`).join('');
  const thisYear = new Date().getFullYear(); const startYear = 1930;
  yy.innerHTML = '<option value="" disabled selected>–ì–æ–¥</option>' + Array.from({length:thisYear-startYear+1}, (_,k)=>thisYear-k).map(y=>`<option value="${y}">${y}</option>`).join('');
})();

function getDOBISO(){
  const dd = el('dobDay').value, mm = el('dobMonth').value, yy = el('dobYear').value;
  if (!dd || !mm || !yy) return '';
  const d = new Date(Number(yy), Number(mm)-1, Number(dd));
  if (d.getFullYear() != yy || (d.getMonth()+1) != Number(mm) || d.getDate() != Number(dd)) return '';
  return `${yy}-${mm}-${dd}`;
}

/* –¥–µ–ª–∏–º —Ç–µ–∫—Å—Ç –Ω–∞ 2‚Äì3 –∞–±–∑–∞—Ü–∞ */
function splitIntoParagraphs(text){
  const partsByBreak = text.split(/\n{2,}/).map(s=>s.trim()).filter(Boolean);
  if (partsByBreak.length >= 2 && partsByBreak.length <= 4) return partsByBreak;
  const sentences = text.split(/(?<=\.)\s+/).map(s=>s.trim()).filter(Boolean);
  if (sentences.length <= 3) { return [sentences.join(' ')]; }
  else if (sentences.length <= 6) { const mid = Math.ceil(sentences.length/2); return [sentences.slice(0,mid).join(' '), sentences.slice(mid).join(' ')]; }
  else { const third = Math.ceil(sentences.length/3); return [ sentences.slice(0, third).join(' '), sentences.slice(third, third*2).join(' '), sentences.slice(third*2).join(' ') ]; }
}

/* –ª–æ–≥–∏–Ω */
el('login').onclick = async () => {
  const email = el('email').value.trim().toLowerCase();
  const dobIso = getDOBISO();
  const st = el('auth_status');
  if(!email || !dobIso){ st.textContent='–í–≤–µ–¥–∏—Ç–µ e-mail –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è'; st.className='err'; return; }
  st.textContent='–ü—Ä–æ–≤–µ—Ä—è–µ–º...'; st.className='';

  try{
    const data = await verify(email, dobIso);
    if(!data.ok){ st.textContent = data.error || '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞'; st.className='err'; return; }
    STATE.user = { email: data.user?.email || email, name: data.user?.name || '–ë–µ–∑ –∏–º–µ–Ω–∏', dob: (data.user?.dob || dobIso).slice(0,10) };
    document.querySelectorAll('#home .nameSpan').forEach(n=>n.textContent=STATE.user.name);
    el('userName').textContent = STATE.user.name;
    el('userDob').textContent = fmtDob(STATE.user.dob);
    show('home'); tg?.MainButton?.hide?.();
  }catch(e){ st.textContent='–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è'; st.className='err'; }
};

/* –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è: –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ö–µ–¥–µ—Ä –≤ —Å–µ–∫—Ü–∏–∏ */
function fillHeader(sectionId){
  const sec = el(sectionId);
  if(!sec) return;
  const nameSpan = sec.querySelector('.nameSpan');
  const tagSpan  = sec.querySelector('.tag');
  if (nameSpan) nameSpan.textContent = STATE.user?.name || '‚Äî';
  if (tagSpan)  tagSpan.textContent  = fmtDob(STATE.user?.dob);
}

/* YEAR */
el('btnYear').onclick = async () => {
  try {
    fillHeader('year');
    const num = computeGeneral2025(STATE.user.dob);
    el('yearNumber').textContent = num;
    const DATA = await loadData();
    let desc = DATA?.GENERAL?.[String(num)] || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.';
    const paragraphs = splitIntoParagraphs(desc);
    el('yearDesc').innerHTML = paragraphs.map(p => `<p>${p}</p>`).join('');
    show('year');
  } catch (err) { console.error('btnYear error:', err); alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ä–∞–∑–¥–µ–ª–∞.'); }
};
el('backHome').onclick = () => show('home');

/* MONTH SECTIONS ‚Äî –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ */
const MONTH_NAMES_FULL = ['–Ø–Ω–≤–∞—Ä—è','–§–µ–≤—Ä–∞–ª—è','–ú–∞—Ä—Ç–∞','–ê–ø—Ä–µ–ª—è','–ú–∞—è','–ò—é–Ω—è','–ò—é–ª—è','–ê–≤–≥—É—Å—Ç–∞','–°–µ–Ω—Ç—è–±—Ä—è','–û–∫—Ç—è–±—Ä—è','–ù–æ—è–±—Ä—è','–î–µ–∫–∞–±—Ä—è'];

function setupMonthSection(secId, dataKey){
  const sec = el(secId);
  const btns = sec.querySelectorAll('.mBtn');
  const resCard  = sec.querySelector('#res-' + secId.split('sec-')[1]);
  const descCard = sec.querySelector('#desc-' + secId.split('sec-')[1]);
  const nameEl = sec.querySelector('.mName');
  const numEl  = sec.querySelector('.mNum');
  const descEl = sec.querySelector('.mDesc');

  // –Ω–∞–≤–µ—à–∏–≤–∞–µ–º –∫–ª–∏–∫–∏
  btns.forEach(b=>{
    b.addEventListener('click', async () => {
      // –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π
      btns.forEach(x=>x.classList.remove('active'));
      b.classList.add('active');

      const m = Number(b.dataset.m);
      const num = computeMonthly(STATE.user.dob, m);
      nameEl.textContent = MONTH_NAMES_FULL[m-1];
      numEl.textContent = num;

      const DATA = await loadData();
      let desc = DATA?.[dataKey]?.[String(num)] || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.';
      const paragraphs = splitIntoParagraphs(desc);
      descEl.innerHTML = paragraphs.map(p => `<p>${p}</p>`).join('');

      resCard.style.display = '';
      descCard.style.display = '';

      // –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
      setTimeout(()=>{ resCard.scrollIntoView({ behavior:'smooth', block:'start' }); }, 40);
    });
  });

  // –∑–∞–ø–æ–ª–Ω—è–µ–º —Ö–µ–¥–µ—Ä –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–µ–∫—Ü–∏—é
  fillHeader(secId);
}

/* –ø–µ—Ä–µ—Ö–æ–¥—ã –≤ —Ä–∞–∑–¥–µ–ª—ã */
el('btnMonths').onclick     = () => { fillHeader('sec-monthly'); show('sec-monthly'); };
el('btnHerbs').onclick      = () => { fillHeader('sec-herbs'); show('sec-herbs'); };
el('btnMinerals').onclick   = () => { fillHeader('sec-minerals'); show('sec-minerals'); };
el('btnVitamins').onclick   = () => { fillHeader('sec-vitamins'); show('sec-vitamins'); };
el('btnOils').onclick       = () => { fillHeader('sec-oils'); show('sec-oils'); };
el('btnSupplements').onclick= () => { fillHeader('sec-supplements'); show('sec-supplements'); };

/* –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ —Å–µ–∫—Ü–∏—è—Ö */
document.querySelectorAll('button.back[data-back="home"]').forEach(b=>{
  b.addEventListener('click', ()=> show('home'));
});
el('backHome').onclick = () => show('home');

/* –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π –ø–æ –º–µ—Å—è—Ü–∞–º */
setupMonthSection('sec-monthly',    'MONTHLY');
setupMonthSection('sec-herbs',      'HERBS');
setupMonthSection('sec-minerals',   'MINERALS');
setupMonthSection('sec-vitamins',   'VITAMINS');
setupMonthSection('sec-oils',       'OILS');
setupMonthSection('sec-supplements','SUPPLEMENTS');

/* –ø—Ä–æ—Ñ–∏–ª—å-–∑–∞–≥–ª—É—à–∫–∞ */
el('profileBtn').onclick = () => alert('–ü—Ä–æ—Ñ–∏–ª—å –¥–æ–±–∞–≤–∏–º –≤ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ üòä');
</script>
</body>
</html>






